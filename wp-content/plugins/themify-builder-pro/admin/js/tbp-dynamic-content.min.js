'use strict';(function(r,p){let g={},v=null,y;const E={},A=tbpDynamic.field_name,J=function(a){if(null===v){const d=Themify.hash(tbpDynamic.v+Object.keys(tbpDynamic.items));v=function(){if(themifyBuilder.debug)return null;try{let b=sessionStorage.getItem("tbp_dc");if(b&&(b=JSON.parse(b),b.h===d&&b.v))return b.v}catch(b){}return null}();null===v&&r.ajax({type:"POST",url:themifyBuilder.ajaxurl,dataType:"json",data:{action:"tpb_get_dynamic_content_fields",tb_load_nonce:themifyBuilder.tb_load_nonce},
error:function(){v=null},success:function(b){v=b;try{sessionStorage.setItem("tbp_dc",JSON.stringify({v:b,h:d}))}catch(e){}a&&a()}})}else a&&a()},R=function(a,d){let b="",e="";const c=function(h){if(void 0!==e||void 0!==b)h||(h=""),void 0!==e&&(h=e+h),void 0!==b&&(h+=b);d&&d(h)};if("string"!==typeof a){if(!a||void 0===a.item)return;a=r.extend(!0,{},a);b=a.text_after;e=a.text_before;delete a.text_before;delete a.text_after;delete a.o;a=JSON.stringify(a)}let f;p.Forms.LayoutPart.id&&document.body.classList.contains("tbp_app_is_edit")&&
(f=p.Instances.Builder[p.builderIndex].el.parentNode.id)&&(f=f.split("-")[1]);f||(f="undefined"===typeof tbp_local||void 0===tbp_local.id||tbp_local.isArchive?themifyBuilder.post_ID:tbp_local.id);const k=Themify.hash(a+f);void 0===E[k]?r.ajax({type:"POST",url:themifyBuilder.ajaxurl,dataType:"json",data:{action:"tpb_get_dynamic_content_preview",tb_load_nonce:themifyBuilder.tb_load_nonce,pid:f,values:a},success:function(h){E[k]=h.error?h.error:""===h.value||"false"===h.value?null:h.value;c(E[k])}}):
c(E[k])},S=function(a,d){const b=ThemifyConstructor.values,e=document.createElement("div");var c=Object.values(r.extend(!0,{},v));const f=tbpDynamic.items;e.className="tbp_dynamic_content_options";for(var k=c.length-1;-1<k;--k)if("item"===c[k].id){k=c[k].options;for(let h in k){for(let l in k[h].options)void 0!==f[l]&&-1===f[l].type.indexOf(a)&&delete k[h].options[l];0===Object.keys(k[h].options).length&&delete k[h]}break}void 0===d&&(d={});ThemifyConstructor.values=d;a=ThemifyConstructor.create(c);
d=a.querySelectorAll(".tb_lb_option");for(c=d.length-1;-1<c;--c)d[c].classList.remove("tb_lb_option","tb_lb_option_child");ThemifyConstructor.values=b;e.appendChild(a);return e},Q=function(a,d){let b=a.parentNode.closest(".tb_field"),e=F(b),c=T(b);var f=b.getElementsByClassName("tb_input")[0];let k={};void 0!==f&&f.parentNode.classList.contains("tb_has_dc")&&(b=f,f=null);const h=U(b,c);null!==e?void 0!==g[e]&&(f=G(b),void 0!==g[e][f]&&(k=g[e][f])):k=g;if(!0===d)if(void 0!==k[h])a.checked=!0;else return;
if(!0===a.checked){b.classList.add("tbp_dc_active");let l=b.getElementsByClassName("tbp_dc_input")[0];void 0===l?(J(function(){const t=document.createElement("div");l=document.createElement("input");t.className="tbp_dc_wrap";l.className="tbp_dc_input xlarge";l.type="text";l.setAttribute("readonly",!0);const I=function(u){u=u.closest(".tbp_dc_wrap");const n=u.querySelector("#item"),w=n.value,m=n.closest(".tb_field").nextElementSibling.children,K="field_"+w,V="field_general_"+c;let B=[];l.value=n.options[n.selectedIndex].text;
B.push(n.parentNode);for(let q=m.length-1;-1<q;--q)""!==w&&(m[q].classList.contains(K)||m[q].classList.contains(V)||"ACF"===w.substring(0,3)&&m[q].classList.contains("tbp_dynamic_content_acf_ctx"))?(m[q].style.display="block",B.push(m[q])):m[q].style.display="";ThemifyConstructor.callbacks();w||(B=null);const N=L(h,B,u);B=null;R(N,function(q){null===q&&(q="image"===c?tbpDynamic.placeholder_image:"{"+N.item+"}");const z=C(n,h);if(null!==z){z.value=q;let H=null;"wp_editor"===c&&(H=tinymce.get(z.id))&&
(H.setContent(String(q)),H.fire("change"));H||(Themify.triggerEvent(z,"change"),"image"!==c&&"SELECT"!==z.nodeName&&Themify.triggerEvent(z,"keyup"))}})};l.addEventListener("click",function(u){u.preventDefault();u.stopImmediatePropagation();let n=this.nextElementSibling;null===n&&(n=S(c,k[h]),r(n).on("change.dc_preview",":input",function(m){m.stopPropagation();I(m.target)}),this.parentNode.appendChild(n));u="block"!==n.style.display;const w=ThemifyBuilderCommon.Lightbox.$lightbox[0].getElementsByClassName("tbp_dynamic_content_options");
for(let m=w.length-1;-1<m;--m)w[m].style.display="";if(!0===u){const m=function(K){null===K.target.closest(".tbp_dc_wrap")&&(document.removeEventListener("mousedown",m,{passive:!0}),"visual"===p.mode&&window.top.document.removeEventListener("mousedown",m,{passive:!0}),n.style.display="");"visual"===p.mode&&r(document).triggerHandler("mouseup")};document.addEventListener("mousedown",m,{passive:!0});"visual"===p.mode&&window.top.document.addEventListener("mousedown",m,{passive:!0});I(this);n.style.display=
"block"}else n.style.display=""});t.appendChild(p.Utils.getIcon("ti-pencil"));t.appendChild(l);if(void 0!==k[h]){var D=k[h].item,x=v[0].options;for(let u in x)if(void 0!==x[u].options[D]){l.value=x[u].options[D];break}if("image"===c&&"styling"===ThemifyConstructor.clicked)for(D=b.closest(".tb_tab").getElementsByClassName("tb_image_options"),x=D.length-1;-1<x;--x)D[x].classList.remove("_tb_hide_binding");else ThemifyConstructor.callbacks()}b.appendChild(t)}),void 0===d&&O(b,h,c)):void 0===d&&(O(b,
h,c),void 0!==k[h]&&l.click(),P(!1))}else void 0===d&&(W(b,h,c),b.classList.remove("tbp_dc_active"),L(h,null,b),P(!0))},G=function(a){return r(a.closest(".tb_repeatable_field")).index()},F=function(a){a=a.parentNode.closest(".tb_row_js_wrapper");return null!==a?a.getAttribute("id"):null},P=function(a){if("visual"===p.mode&&"styling"===ThemifyConstructor.clicked){var d=p.liveStylingInstance.$liveStyledElmt[0].closest(".tb_active_layout_part");null===d&&(d=p.liveStylingInstance.$liveStyledElmt[0]);
d=d.getElementsByClassName("tbp_dc_styles");for(let b=d.length-1;-1<b;--b)d[b].sheet.disabled=a}},U=function(a,d){d="image"===d?"tb_uploader_input":null!==a.parentNode.closest(".tb_repeatable_field_content")?"tb_lb_option_child":"tb_lb_option";a=a.getElementsByClassName(d)[0];let b;void 0!==a&&(b=a.getAttribute("data-input-id"));b||(b=a.getAttribute("id"));return b.trim()},L=function(a,d,b){let e=null,c=F(b);null!==c&&(e=G(b));if(null===d)if((b=(b=y.value)?JSON.parse(b):{})||(b={}),null!==e){var f=
!1;if(void 0!==b[c]){if(null===a)void 0!==b[c][e]&&(f=!0,delete g[c][e],delete b[c][e]);else if(void 0!==b[c][e]&&void 0!==b[c][e][a]){if(f=!0,delete b[c][e][a],a=Object.keys(b[c][e]).length,0===a||1===a&&void 0!==b[c][e].o)f=!0,delete g[c][e],delete b[c][e]}else return;if(0===Object.keys(b[c]).length||1===Object.keys(b[c]).length&&void 0!==b[c].repeatable)f=!0,delete g[c],delete b[c]}if(!1===f)return}else if(void 0!==b[a])delete b[a];else return;else{null!==e?(void 0===g[c]&&(g[c]={}),g[c].repeatable=
1,void 0===g[c][e]&&(g[c][e]={}),void 0===g[c][e][a]&&(g[c][e][a]={}),b=void 0!==g[c][e][a].o?g[c][e][a].o:null):(void 0===g[a]&&(g[a]={}),b=void 0!==g[a].o?g[a].o:null);if(Array.isArray(d)){f={};for(let k=d.length-1;-1<k;--k){let h=d[k].querySelectorAll("input,textarea,select");for(let l=h.length-1;-1<l;--l){let t=h[l].value;""===t||h[l].parentNode.parentNode.classList.contains("_tb_hide_binding")||(f[h[l].id]=t)}}d=p.Utils.clear(f)}null!==e?(g[c][e][a]=d,null!==b&&(g[c][e][a].o=b)):(g[a]=d,null!==
b&&(g[a].o=b));b=g}y.value=JSON.stringify(b);return d},C=function(a,d){a=a.closest(".tb_repeatable_field_content");return a=null!==a?a.querySelector('.tb_lb_option_child[data-input-id="'+d+'"]'):ThemifyBuilderCommon.Lightbox.$lightbox[0].querySelector("#"+d)},O=function(a,d,b){let e=null,c=null,f=d;"wp_editor"===b?((b=tinymce.get(d))||(b=tinymce.get(C(a,d).id)),b&&(e=b.getContent())):(b=C(a,d),null!==b&&(e=b.value));b=F(a);null!==b&&(c=G(a),f=b);null!==e&&""!==e?(void 0===g[f]&&(g[f]={}),null!==c?
(void 0===g[f][c]&&(g[f][c]={}),void 0===g[f][c][d]&&(g[f][c][d]={}),g[f][c][d].o=e):g[f].o=e):void 0!==g[f]&&(null!==c?void 0!==g[f][c]&&void 0!==g[f][c][d]&&delete g[f][c][d].o:delete g[f].o);y.value=JSON.stringify(g);return e},W=function(a,d,b){let e=F(a),c="";if(null!==e){if(void 0!==g[e]){const f=G(a);void 0!==g[e][f]&&void 0!==g[e][f][d]&&void 0!==g[e][f][d].o&&(c=g[e][f][d].o)}}else void 0!==g[d]&&void 0!==g[d].o&&(c=g[d].o);"wp_editor"===b?((b=tinymce.get(d))||(b=tinymce.get(C(a,d).id)),b&&
(b.setContent(String(c)),b.fire("change"))):(a=C(a,d),null!==a&&(a.value=c,Themify.triggerEvent(a,"change"),"image"!==b&&"SELECT"!==a.nodeName&&Themify.triggerEvent(a,"keyup")))},T=function(a){a=a.getAttribute("data-type");"imageGradient"===a?a="image":"title"===a&&(a="text");return a},X=function(){const a={};r.each(tbpDynamic.items,function(d,b){r.each(b.type,function(e,c){void 0===a[c]&&(a[c]=c)})});a.title="title";a.imageGradient="imageGradient";return Object.keys(a)},M=function(a,d=[]){const b=
tbpDynamic.excludes,e=tbpDynamic.d_label;0===d.length&&(d=X());var c=!1;for(let k=d.length-1;-1<k;--k){let h=a.querySelectorAll('.tb_field[data-type="'+d[k]+'"]');for(let l=h.length-1;-1<l;--l)if(!h[l].classList.contains("tb_has_dc")&&!h[l].classList.contains("tb_disable_dc")){c=!1;for(var f=b.length-1;-1<f;--f)if(h[l].classList.contains(b[f])){c=!0;break}if(!1===c){h[l].className+=" tb_has_dc";c=document.createElement("label");f=document.createElement("input");let t=document.createElement("div");
c.className="tpb_dc_toggle switch-wrapper";f.type="checkbox";f.className="toggle_switch";t.className="switch_label";t.setAttribute("data-on",e);t.setAttribute("data-off",e);f.addEventListener("change",function(I){I.stopPropagation();Q(this)},{passive:!0});c.appendChild(f);c.appendChild(t);h[l].insertBefore(c,h[l].firstChild);Q(f,!0)}}}};r(window).one("load",function(){Themify.requestIdleCallback(function(){if("visual"!==p.mode||!0===Themify.is_builder_loaded)setTimeout(J,1500);else window.top.Themify.body.one("themify_builder_ready",
function(a){setTimeout(J,2500)});r(document).on("tb_repeatable_add_new tb_repeatable_duplicate tb_repeatable_delete",function(a){"tb_repeatable_delete"===a.type?L(null,null,a.detail[0]):M(a.detail[0])}).on("tb_editing_module tb_editing_row tb_editing_column tb_editing_subrow",function(a){a=ThemifyConstructor;const d=ThemifyBuilderCommon.Lightbox.$lightbox[0];y=a.hidden.render({type:"hidden","class":"exclude-from-reset-field",responsive:!1,control:!1,id:A},a);if(void 0!==a.values[A])try{g="string"===
typeof a.values[A]?JSON.parse(a.values[A]):r.extend(!0,{},a.values[A]),y.value=JSON.stringify(g)}catch(b){g={}}else g={};d.getElementsByClassName("tb_options_tab_content")[0].appendChild(y);M(d)});Themify.body.on("themify_builder_tabsactive tb_options_expand",function(a,d,b){if(null!==p.activeModel){let e=ThemifyConstructor.clicked;setTimeout(function(){e=ThemifyConstructor.clicked;"animation"!==e&&"visibility"!==e&&("tb_options_expand"===a.type&&(b=d,d=null),"styling"===e&&null!==d&&-1!==d.indexOf("_h")||
M(b,"styling"===e?["imageGradient","image"]:[]))},"setting"===e?0:50)}})},15)})})(jQuery,tb_app);
